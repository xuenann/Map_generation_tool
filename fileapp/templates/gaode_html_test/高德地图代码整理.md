# 高德地图代码整理



https://lbs.amap.com/demo/javascript-api-v2/example/map-lifecycle/map-show



## 地图工具类

### 地图

#### 地图属性

##### 获取地图中心点/级别

- [查看文档](https://lbs.amap.com/demo/javascript-api-v2/example/map/get-mapzoom)

```html
  // 右上角展示信息
  <div class="info">
    <h4>获取地图级别与中心点坐标</h4>
    <p>当前级别：<span id="map-zoom">11</span></p>
    <p>当前中心点：<span id="map-center">121.498586,31.239637</span></p>
  </div>
  
<script>
  //显示地图层级与中心点信息
    function logMapinfo(){
      var zoom = map.getZoom(); //获取当前地图级别
      var center = map.getCenter(); //获取当前地图中心位置

      document.querySelector("#map-zoom").innerText = zoom;
      document.querySelector("#map-center").innerText = center.toString();
    };
    
	//绑定地图移动与缩放事件
    map.on('moveend', logMapinfo);
    map.on('zoomend', logMapinfo);
</script>
```



##### 获取当前行政区

- [查看文档](https://lbs.amap.com/demo/javascript-api-v2/example/map/get-current-administrative-region)

```html
  <div class="info">
    <h4>当前所在行政区信息</h4>
    <p><span id="map-city"></span></p>
  </div>
  
  <script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/js/jquery-1.11.1.min.js" ></script>
  <script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/js/underscore-min.js" ></script>
  <script type="text/javascript" src="https://a.amap.com/jsapi_demos/static/demo-center/js/backbone-min.js" ></script>
  <script type="text/javascript" src='https://a.amap.com/jsapi_demos/static/demo-center/js/prety-json.js'></script>
  
<script>
  //获取并展示当前城市信息
    function logMapinfo(){
      map.getCity( function(info){
        var node = new PrettyJSON.view.Node({
            el: document.querySelector("#map-city"),
            data: info
        });
      });
    }
    
    logMapinfo();
    //绑定地图移动事件
    map.on('moveend', logMapinfo);
</script>
```



##### 设置地图当前行政区

- [查看文档](https://lbs.amap.com/demo/javascript-api-v2/example/map/set-center-according-to-map-name)

```html
<div class="input-card" style="width:24rem;">
    <h4>设置地图当前行政区</h4>
    <div class="input-item">
      <input id='city-name' placeholder="北京市" type="text" style="margin-right:1rem;"><button class="btn" id="query">去指定城市</button>
    </div>
  </div>
  
<script>
  //根据cityname、adcode、citycode设置地图位置
    function gotoCity() {
      var val = document.querySelector('#city-name').value; //可以是cityname、adcode、citycode
      if (!val) {
        val = "北京市";
      }
      map.setCity(val);
      log.info(`已跳转至${val}`);
    }
    
    //绑定查询点击、回车事件
    document.querySelector('#query').onclick = gotoCity;
    document.querySelector('#city-name').onkeydown = function(e) {
      if (e.keyCode === 13) {
        gotoCity();
        return false;
      }
      return true;
    };
</script>
```



##### 获取鼠标点击经纬度

- [查看文档](https://lbs.amap.com/demo/javascript-api-v2/example/map/click-to-get-lnglat)

```html
<div class="input-card">
    <h4>左击获取经纬度：</h4>
    <div class="input-item">
      <input type="text" readonly="true" id="lnglat">
    </div>
</div>

<script>
	//为地图注册click事件获取鼠标点击出的经纬度坐标
    map.on('click', function(e) {
        document.getElementById("lnglat").value = e.lnglat.getLng() + ',' + e.lnglat.getLat()
    });
</script>
```



#### 覆盖物与图层管理

##### 图层的添加与移除

- [查看文档](https://lbs.amap.com/demo/javascript-api-v2/example/map-componets/map-layers)

```html
  <div class="input-card" style="width:24rem;">
    <h4>添加、删除图层（Layer）</h4>
    <div class="input-item">
      <label>卫星图层：</label>
      <button class="btn" id="add-satellite-layer" style="margin-right:1rem;">添加卫星图层</button>
      <button class="btn" id="remove-satellite-layer">删除卫星图层</button>
    </div>
    <div class="input-item">
      <label>红色标记：</label>
      <button class="btn" id="add-roadnet-layer" style="margin-right:1rem;">添加路网图层</button>
      <button class="btn" id="remove-roadnet-layer">删除路网图层</button>
    </div>
  </div>
  
  <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
  
<script>
    // 构造官方卫星、路网图层
    var satelliteLayer = new AMap.TileLayer.Satellite();
    var roadNetLayer =  new AMap.TileLayer.RoadNet();

    //批量添加图层
    map.add([satelliteLayer, roadNetLayer]);

    //事件绑定
    document.querySelector("#add-satellite-layer").onclick = function() {
      map.add(satelliteLayer);
    }

    document.querySelector("#remove-satellite-layer").onclick = function() {
      map.remove(satelliteLayer);
    }

    document.querySelector("#add-roadnet-layer").onclick = function() {
      map.add(roadNetLayer);
    }

    document.querySelector("#remove-roadnet-layer").onclick = function() {
      map.remove(roadNetLayer);
    }
</script>
```



##### 地图控件

- [查看文档](https://lbs.amap.com/demo/javascript-api-v2/example/map-componets/map-with-function-control)

```html
<script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=您申请的key值&&plugin=AMap.Scale,AMap.HawkEye,AMap.ToolBar,AMap.ControlBar"></script>
    
<div class='input-card'>
    <div class="input-item">
        <input type="checkbox" checked onclick="toggleScale(this)"/>比例尺
    </div>
    <div class="input-item">
        <input type="checkbox" checked id="toolbar" onclick="toggleToolBar(this)"/>工具条
    </div>
    <div class="input-item">
        <input type="checkbox" checked id="controlBar" onclick="toggleControlBar(this)"/>工具条方向盘
    </div>
    <div class="input-item">
        <input type="checkbox" checked id="overview" onclick="toggleOverViewShow(this)"/>显示鹰眼
    </div>
</div>  

<script>
var scale = new AMap.Scale(),
    toolBar = new AMap.ToolBar({
        position: {
            top: '110px',
            right: '40px'
        }
    }),
    controlBar = new AMap.ControlBar({
        position: {
            top: '10px',
            right: '10px',
        }
    }),
    overView = new AMap.HawkEye({
        opened: false
    }),
    map = new AMap.Map("container", {
        viewMode: '3D',
        zoom: 11,
        pitch: 30,
    });
    map.addControl(scale);
    map.addControl(toolBar);
    map.addControl(controlBar);
    map.addControl(overView);
    function toggleScale(checkbox) {
        if (checkbox.checked) {
            scale.show();
        } else {
            scale.hide();
        }
    }
    function toggleToolBar(checkbox) {
        if (checkbox.checked) {
            showToolBar();
        } else {
            hideToolBar();
        }
    }
    function toggleControlBar(checkbox) {
        if (checkbox.checked) {
            controlBar.show()
        } else {
            controlBar.hide()
        }
    }
    function toggleOverViewShow(checkbox) {
        if (checkbox.checked) {
            overView.show();
        } else {
            overView.hide();
        }
    }
</script>
```



#### 自定义地图样式

##### 地图显示要素

- [查看文档](https://lbs.amap.com/demo/javascript-api-v2/example/personalized-map/set-map-cotent)

```html
  <div class="input-card" style="width:19rem">
    <h4>设置地图显示要素（Features）</h4>
    <div id="map-features">
      <div class="input-item">
        <input type='checkbox' name='mapStyle' value='bg' checked>
        <span class="input-text">区域面（bg）</span>
      </div>
      <div class="input-item">
        <input type='checkbox' name='mapStyle' value='road' checked>
        <span class="input-text">道路（road）</span>
      </div>
      <div class="input-item">
        <input type='checkbox' name='mapStyle' value='building' checked>
        <span class="input-text">建筑物（building）</span>
      </div>
      <div class="input-item">
        <input type='checkbox' name='mapStyle' value='point' checked>
        <span class="input-text">标注（point）</span>
      </div>
    </div>
  </div>
  
  <script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
  
  <script>
    //初始化地图
    var map = new AMap.Map('container', {
      zoom: 17,
      viewMode: '3D',
      center: [116.408075, 39.950187],
      features: ['bg', 'road', 'building', 'point']
    });

    //设置地图显示要素
    function setMapFeatures() {
      var features = [];
      var inputs = document.querySelectorAll("#map-features input");
      inputs.forEach(function(input) {
        if (input.checked) {
          features.push(input.value);
        }
      });
      map.setFeatures(features);
    }

    //绑定checkbox点击事件
    var inputs = document.querySelectorAll("#map-features input");
    inputs.forEach(function(checkbox) {
      checkbox.onclick = setMapFeatures;
    });
  </script>
```



### 图层

#### 图层通用接口

##### 图层透明度

- [查看文档](https://lbs.amap.com/demo/javascript-api-v2/example/layer-common/layer-opacity)

```html
<div class="input-card" style="width: auto;">
    <div>
        <label>图层透明度：</label><span id="opa-val">-</span>
        <br>
        <input id="opacity" type="range" value="0.6" min="0" max="1" step="0.01">
    </div>
</div>

<script src="https://cache.amap.com/lbs/static/es5.min.js"></script>

<script>
    var map = new AMap.Map('container', {
        center: [116.40, 39.91],
        features: ['road', 'bg'],
        zoom: 13
    });

    var opacity = 0.6;

    var satellite = new AMap.TileLayer.Satellite({
        map: map,
        opacity: opacity
    });

    updateOpa(opacity);

    function updateOpa(v) {
        document.getElementById('opa-val').innerText = v;
    }

    function setOpacity(e) {
      	var val = e.target.value
        updateOpa(val);
        satellite.setOpacity(val);
    }
  	
  	document.getElementById('opacity').addEventListener('input', setOpacity);
</script>
```



### 覆盖物

#### 点标记

##### 设置点的拖拽效果

- [查看文档](https://lbs.amap.com/demo/javascript-api-v2/example/marker/set-marker-draggable)

```html
var marker = new AMap.Marker({
        position: map.getCenter(),
        icon: '//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png',
        offset: new AMap.Pixel(-13, -30),
        // 设置是否可以拖拽
        draggable: true,
        cursor: 'move',
    });
```



















































